CREATE OR REPLACE TRIGGER TRG_USER 
    AFTER UPDATE OR INSERT OR DELETE ON Usuario
    FOR EACH ROW
DECLARE
    VCOD NUMBER;
    VMES VARCHAR2(500);
BEGIN

    IF DELETING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA BORRADO UN USUARIO:'|| :OLD.id_usuario ||' '|| :OLD.nombre||' '||:OLD.username);
    ELSIF UPDATING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA ACTUALIZADO UN USUARIO:'|| :OLD.id_usuario ||' '|| :OLD.nombre||' '||:OLD.username);
    ELSIF INSERTING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA INSERTADO UN USUARIO'|| :NEW.id_usuario ||' '|| :NEW.nombre||' '||:NEW.username); 
    END IF;
    
EXCEPTION
    WHEN OTHERS THEN
        VMES := SQLERRM;
        VCOD := SQLCODE;
        INSERT INTO ERRORES_AUDIT (USUARIO, ORIGEN, FECHA, VERROR)
        VALUES (USER, 'TRG_USER', SYSDATE, VCOD || ' - ' || VMES);
END;

CREATE OR REPLACE TRIGGER TRG_PRODUCTOS 
    AFTER UPDATE OR INSERT OR DELETE ON Producto
    FOR EACH ROW
DECLARE
    VCOD NUMBER;
    VMES VARCHAR2(500);
BEGIN

    IF DELETING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA BORRADO UN PRODUCTO:'|| :OLD.id_producto ||' '|| :OLD.nombre);
    ELSIF UPDATING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA ACTUALIZADO UN PRODUCTO:'|| :OLD.id_producto ||' '|| :OLD.nombre||' '||:OLD.existencias||' '||:NEW.existencias);
    ELSIF INSERTING THEN
        INSERT INTO MENSAJE_TRIGGERS VALUES(USER,' SE HA INSERTADO UN PRODUCTO'|| :NEW.id_producto ||' '|| :NEW.nombre||' '||:NEW.existencias); 
    END IF;
    
EXCEPTION
    WHEN OTHERS THEN
        VMES := SQLERRM;
        VCOD := SQLCODE;
        INSERT INTO ERRORES_AUDIT (USUARIO, ORIGEN, FECHA, VERROR)
        VALUES (USER, 'TRG_PRODUCTOS', SYSDATE, VCOD || ' - ' || VMES);
END;
